(function(){function V(b){return"object"==typeof b&&3===ba(b)&&!b.nodeType&&b.constructor===Object}function ja(b){return!0===b||!1===b}function w(b){return"function"==typeof b}function u(b){return"string"==typeof b||b===""+b}function J(b){return"object"===typeof b&&5===ba(b)}function ca(b){if(null===b||"object"!=typeof b)return!1;b=ba(b);return 2<b||-1==b}function t(){}function va(b,a,c,d,e,f){e=e||"before";return function(){if("instead"==e)return a.apply(c||d,arguments);if("before"==e){var g=a.apply(c||
d,arguments);var h=!1!==g?b.apply(d||c,arguments):null}else h=b.apply(d||c,arguments),g=a.apply(c||d,arguments);return f?g:h}}function B(b,a){return b.getAttribute?b.getAttribute(a):null}function X(b,a,c,d){return setTimeout(function(){b.apply(a,c||[])},d||0)}function pa(b,a){if(!b||!u(b))return null;try{var c=new DOMParser;var d=c.parseFromString(b,a||"text/xml")}catch(e){d=void 0}if(!d||d.getElementsByTagName("parsererror").length)throw"Invalid XML: "+b;return d}function ka(b){if(b&&void 0!=!b.length&&
b!==""+b){for(var a=[],c=-1,d=b.length>>>0;++c!==d;a[c]=b[c]);return a}return b?[b]:[]}function N(b){if(!b)return!1;var a,c;return"object"!=(c=typeof b)&&"function"!=c?!1:w(a=b.then)?a:!1}function da(){return!1}function ea(){return!0}function wa(b,a,c){c||(c="asc");b=b.slice();b.sort(function(c,b){var d=typeof c,e=c,h=b;if(d!=typeof b)return 0;"object"==d&&(w(a)?(e=a(c),h=a(b)):(e=c[a],h=b[a]));if("number"==typeof e)return e-h;e=(""+e).toLowerCase();h=(""+h).toLowerCase();return e===h?0:e>h?1:-1});
return"desc"==c?b.reverse():b}var K={},E=Array.prototype.slice,xa=Object.prototype.toString,ba=function(){var b={"[object String]":0,"[object Number]":1,"[object Boolean]":2,"[object Object]":3,"[object Function]":4,"[object Array]":5,"[object RegExp]":9,"[object Date]":10};return function(a){if(!a){if(null===a)return 6;if(void 0===a)return 7}var c=b[xa.call(a)];return void 0===c?-1:1===c&&isNaN(a)?8:c}}(),p=function(){return function a(){var c=!1,d=!1,e=E.call(arguments),f=e.shift(),g,h,k;ja(e[e.length-
1])&&(c=e.pop());ja(e[e.length-1])&&(d=c,c=e.pop());for(;e.length;)if((g=e.shift())&&g.hasOwnProperty)for(h in g)if(g.hasOwnProperty(h)&&void 0!==(k=g[h]))if(d)if(f[h]&&V(f[h])&&V(k))a(f[h],k,c,d);else{if(!0===c||void 0==f[h])V(k)?(f[h]={},a(f[h],k,c,!0)):f[h]=k}else if(!0===c||void 0==f[h])f[h]=k;return f}}(),ya=function(){var b,a=function(a){var c={},e=[];0==arguments.length&&(a=!0);return{addFinder:function(a,c,b){e[b?"unshift":"push"]({fn:a,context:c})},add:function(b,d,e){if(c[b]&&!1===c[b].rewritable)return c[b];
c[b]={rewritable:"undefined"!=typeof e?e:a,value:d};return d},get:function(a){if(c[a])return c[a].value;if(e.length){var b;var d=0;for(b=e.length;d<b;d++){var f=e[d].fn.call(e[d].context,a,this);if(void 0!==f)return this.add(a,f,!0)}}},remove:function(a){var b=c[a];b&&!0===b.rewritable&&delete c[a];return b?b.value:void 0},exists:function(a){return!!c[a]},eachEntry:function(a,b){for(var d in c)a.call(b,c[d].value,d)},destroy:function(){this===b&&(b=null);this.remove=this.exists=this.destroy=this.get=
this.add=a=c=null}}};a.global=function(){b||(b=new a(!0));return b};return a}(),la=function(){var b=function(a,b,f){f=f||new ya(!1);var d=b?b.length:null;a||(a="undefined"!==typeof global?global:window);var e=function(a){return a&&b&&a.substr(0,d)!==b?b+"."+a:a},k=function(c,d){c=e(c);if(f.exists(c))return f.get(c);if(!d){d=c.split(".");var h,v=d.length,g=a;for(h=0;h<v;h++){var k=d[h];if(b&&0===h&&k===b)g=a;else{if(void 0===g[k])return;g=g[k]}}g&&f.add(c,g);return g}};this.register=function(c,d){c=
e(c);var h=c.split("."),v=h.pop();var g=h.join(".");var k=h.length,O=a;if(f[g])c=[f[g],v,c];else{if(0<k)for(g=0;g<k;g++){var C=h[g];b&&0===g&&C===b?O=a:(void 0===O[C]&&(O[C]={}),O=O[C])}c=[O,v,c]}h=c[0];v=c[1];ca(h)&&void 0===h[v]&&(h[v]=d,f.add(c[2],d));return d};this.exists=function(a){return void 0!==k(a,!0)};this.get=k;this.add=function(a,c){a=e(a);f.add(a,c);return c};this.remove=function(a){a=e(a);f.remove(a)};this.normalize=e;this.makeAlias=function(a,c){a=e(a);c=e(c);a=f.get(a);void 0!==a&&
f.add(c,a)};this.destroy=function(){var a;this===c&&(c=null);f.eachEntry(function(a){a&&a.$destroy&&a.$destroy()});f.destroy();f=null;for(a in this)this[a]=null}},a=b.prototype;a=a.register=a.exists=a.get=a.add=a.remove=a.normalize=a.makeAlias=a.destroy=null;var c;b.global=function(){c||(c=new b);return c};return b}(),za=function(b,a){var c=function(){};c.prototype=b.prototype;c=new c;b=b.apply(c,a);return ca(b)||!1===b?b:c},H=function(){var b=function(){this.$super&&this.$super!==t&&this.$super.apply(this,
arguments)},a=function(a,c,b){var $super=a.prototype[c]||("$constructor"===c?a:t)||t;return function(){var a=this.$super;if(this.$destroyed)return this.$super=null;this.$super=$super;var c=b.apply(this,arguments);this.$super=a;return c}},c=function(c,b,d,e){var f,h=d.prototype;for(f in b)if(b.hasOwnProperty(f)){var g=h[f];var v=b[f];c[f]=!w(v)||g&&!w(g)?v:a(d,f,v)}e||(c.$plugins=null,c.$pluginMap=null,h.$beforeInit?(c.$beforeInit=h.$beforeInit.slice(),c.$afterInit=h.$afterInit.slice(),c.$beforeDestroy=
h.$beforeDestroy.slice(),c.$afterDestroy=h.$afterDestroy.slice()):(c.$beforeInit=[],c.$afterInit=[],c.$beforeDestroy=[],c.$afterDestroy=[]))},d=function(a){a||(a=new la);var f=function(c){return function(){var b=[],d=[],e=arguments,f,h;if(!this)throw"Must instantiate via new: "+c;this.$plugins=[];(f=this.$constructor.apply(this,arguments))&&J(f)&&(e=f);var g=this.$plugins;var k=this.$pluginMap={};f=-1;for(h=this.$beforeInit.length;++f<h;b.push([this.$beforeInit[f],this]));f=-1;for(h=this.$afterInit.length;++f<
h;d.push([this.$afterInit[f],this]));if(g&&g.length)for(f=0,h=g.length;f<h;f++){var m=g[f];if(u(m)){var C=m;m=a.get(m,!0);if(!m)throw C+" not found";}m=new m(this,e);k[m.$class]=m;m.$beforeHostInit&&b.push([m.$beforeHostInit,m]);m.$afterHostInit&&d.push([m.$afterHostInit,m]);g[f]=m}f=-1;for(h=b.length;++f<h;b[f][0].apply(b[f][1],e));this.$init&&this.$init.apply(this,e);f=-1;for(h=d.length;++f<h;d[f][0].apply(d[f][1],e));}},h=function(){};p(h.prototype,{$class:null,$extends:null,$plugins:null,$pluginMap:null,
$mixins:null,$destroyed:!1,$destroying:!1,$constructor:t,$init:t,$beforeInit:[],$afterInit:[],$beforeDestroy:[],$afterDestroy:[],$getClass:function(){return this.$class},$is:function(a){return C(this,a)},$getParentClass:function(){return this.$extends},$intercept:function(a,c,b,d,e){var f=this[a];this[a]=va(f||t,c,b||this,this,d,e);return f||t},$implement:function(a){var b=this.constructor;b&&b.$parent&&c(this,a,b.$parent,!0)},$hasPlugin:function(c){return!!this.$pluginMap[a.normalize(c)]},$getPlugin:function(c){return this.$pluginMap[a.normalize(c)]||
null},$bind:function(a){var c=this;return function(){if(!c.$isDestroyed())return a.apply(c,arguments)}},$isDestroyed:function(){return n.$destroying||n.$destroyed},$destroy:function(){var a=this.$beforeDestroy,c=this.$afterDestroy,b=this.$plugins,d;if(!this.$destroying&&!this.$destroyed){this.$destroying=!0;var e=-1;for(d=a.length;++e<d;a[e].apply(this,arguments));e=0;for(d=b.length;e<d;e++)b[e].$beforeHostDestroy&&b[e].$beforeHostDestroy.call(b[e],arguments);a=this.destroy.apply(this,arguments);
e=-1;for(d=c.length;++e<d;c[e].apply(this,arguments));e=0;for(d=b.length;e<d;e++)b[e].$destroy.apply(b[e],arguments);if(!1!==a)for(e in this)this.hasOwnProperty(e)&&(this[e]=null);this.$destroying=!1;this.$destroyed=!0}},destroy:function(){}});h.$self=h;h.$instantiate=function(){var a=arguments;switch(a.length){case 0:return new this;case 1:return new this(a[0]);case 2:return new this(a[0],a[1]);case 3:return new this(a[0],a[1],a[2]);case 4:return new this(a[0],a[1],a[2],a[3]);default:return za(this,
a)}};h.$override=function(a){var b=this.$self,d=this.$parent;b&&d&&c(b.prototype,a,d)};h.$extend=function(a,c){return k(a,c,this)};h.$destroy=function(){for(var a in this)this[a]=null};var k=function(d,e,g){d=d||{};var k=d.$class,v=g||d.$extends,q=d.$mixins;g=d.$alias;var C,m;if(v)if(u(v))var n=a.get(v);else n=v,v=n.$class||"";else n=h,v="";if(v&&!n)throw v+" not found";k&&(k=a.normalize(k));d.$class=k;d.$extends=v;d.$mixins=null;v=Object.create(n.prototype);d.$constructor=d.$constructor||b;c(v,d,
n);if(q)for(d=0,C=q.length;d<C;d++){var l=q[d];u(l)&&(l=a.get(l,!0));var r=void 0,P=v;for(r in l)l.hasOwnProperty(r)&&("$beforeInit"===r?P.$beforeInit.push(l[r]):"$afterInit"===r?P.$afterInit.push(l[r]):"$beforeDestroy"===r?P.$beforeDestroy.push(l[r]):"$afterDestroy"===r?P.$afterDestroy.push(l[r]):P[r]||(P[r]=l[r]))}q=f(k);v.constructor=q;v.$self=q;q.prototype=v;for(m in h)"prototype"!==m&&h.hasOwnProperty(m)&&(q[m]=h[m]);for(m in n)"prototype"!==m&&n.hasOwnProperty(m)&&(q[m]=n[m]);if(e)for(m in e)"prototype"!==
m&&e.hasOwnProperty(m)&&(q[m]=e[m]);q.$parent=n;q.$self=q;k&&a.register(k,q);g&&a.register(g,q);return q},C=function(c,b){return(b=u(b)?a.get(b):b)?c instanceof b:!1},n=this;n.factory=function(c){var b=a.get(c),d=E.call(arguments,1);if(!b)throw c+" not found";return b.$instantiate.apply(b,d)};n.isSubclassOf=function(c,b){var d=c,e=a.get;b=u(b)?a.normalize(b):b.prototype.$class;for(u(c)&&(d=e(a.normalize(c)));d&&d.prototype;){if(d.prototype.$class===b)return!0;d=d.$parent}return!1};n.isInstanceOf=
C;n.define=k;n.destroy=function(){n===e&&(e=null);h.$destroy();h=null;a.destroy();d=a=null};n.BaseClass=h};d.prototype={factory:null,isSubclassOf:null,isInstanceOf:null,define:null,destroy:null};var e;d.global=function(){e||(e=new d(la.global()));return e};return d}(),Y=new la(K,"MetaphorJs");H=new H(Y);var M=H.define,l=Function.prototype.bind?function(b,a){return b.bind(a)}:function(b,a){return function(){return b.apply(a,arguments)}},ra=function(){return String.prototype.trim?function(b){return u(b)?
b.trim():b}:function(b){return u(b)?b.replace(/^\s\s*/,"").replace(/\s\s*$/,""):b}}(),Aa=function(){return"undefined"!=typeof JSON?function(b){return JSON.parse(b)}:function(b){return(new Function("return "+b))()}}(),sa=function(){var b=/^[\w[:#.][\w\]*^|=!]*$/,a=/=([^\]]+)/,c=/ *, */,d=/(\([^)]*)\+/,e=/(\[[^\]]+)~/,f=/(~|>|\+)/,g=/ +/,h=/([^[:.#]+)?(?:#([^[:.#]+))?(?:\.([^[:.]+))?(?:\[([^!&^*|$[:=]+)([!$^*|&]?=)?([^:\]]+)?\])?(?::([^(]+)(?:\(([^)]+)\))?)?/,k=/(?:(-?\d*)n)?(?:(%|-)(\d*))?/,C=/\D/,
n=/[^(]*\(([^)]*)\)/,m=/\(.*/,v=/\[([^!~^*|$ [:=]+)([$^*|]?=)?([^ :\]]+)?\]/,q=window.document,L=!!q.getElementsByClassName,O=!!q.querySelectorAll,F={"first-child":function(a){return a.parentNode.getElementsByTagName("*")[0]!==a},"last-child":function(a){for(;(a=a.nextSibling)&&1!==a.nodeType;);return!!a},root:function(a){return"html"!==a.nodeName.toLowerCase()},"nth-child":function(a,c){var b=a.nodeIndex||0,d=c[3]=c[3]?("%"===c[2]?-1:1)*c[3]:0;c=c[1];if(b)return!((b+d)%c);var e=a.parentNode.firstChild;
b++;do if(1===e.nodeType&&(e.nodeIndex=++b)&&a===e&&(b+d)%c)return 0;while(e=e.nextSibling);return 1},"nth-last-child":function(a,c){var b=a.nodeIndexLast||0,d=c[3]?("%"===c[2]?-1:1)*c[3]:0;c=c[1];if(b)return!((b+d)%c);var e=a.parentNode.lastChild;b++;do if(1===e.nodeType&&(e.nodeLastIndex=b++)&&a===e&&(b+d)%c)return 0;while(e=e.previousSibling);return 1},empty:function(a){return!!a.firstChild},parent:function(a){return!a.firstChild},"only-child":function(a){return 1!==a.parentNode.getElementsByTagName("*").length},
checked:function(a){return!a.checked},lang:function(a,c){return a.lang!==c&&q.documentElement.lang!==c},enabled:function(a){return a.disabled||"hidden"===a.type},disabled:function(a){return!a.disabled},selected:function(a){return!a.selected}},l={},p=function(a){return l[a]||(l[a]=new RegExp("(^| +)"+a+"($| +)"))},u={"":function(a,c){return null!==B(a,c)},"=":function(a,c,b){var d;return(d=B(a,c))&&d===b},"&=":function(a,c,b){var d;return(d=B(a,c))&&p(b).test(d)},"^=":function(a,c,b){var d;return(d=
B(a,c)+"")&&!d.indexOf(b)},"$=":function(a,c,b){var d;return(d=B(a,c)+"")&&d.indexOf(b)===d.length-b.length},"*=":function(a,c,b){var d;return(d=B(a,c)+"")&&-1!==d.indexOf(b)},"|=":function(a,c,b){var d;return(d=B(a,c)+"")&&(d===b||!!d.indexOf(b+"-"))},"!=":function(a,c,b){var d;return!(d=B(a,c))||!p(b).test(d)}},w=function(r,l){l=l||q;var x=[],p=null,w,t,z;if(O&&l.querySelectorAll)try{x=ka(l.querySelectorAll(r.replace(a,'="$1"')))}catch(Ca){p=!0}if(!O||p)if(b.test(r))switch(p=0,r.charAt(0)){case "#":p=
r.slice(1);x=q.getElementById(p);x.id!==p&&(x=q.all[p]);x=x?[x]:[];break;case ".":r=r.slice(1);if(L)x=ka((x=l.getElementsByClassName(r)).length?x:[]);else{r=" "+r+" ";var G=l.getElementsByTagName("*");for(w=0;l=G[w++];)-1!==(" "+l.className+" ").indexOf(r)&&(x[p++]=l);x=p?x:[]}break;case ":":G=l.getElementsByTagName("*");w=0;var B=r.replace(n,"$1");for(t=r.replace(m,"");l=G[w++];)F[t]&&!F[t](l,B)&&(x[p++]=l);x=p?x:[];break;case "[":G=l.getElementsByTagName("*");w=0;l=v.exec(r);r=l[1];var D=l[2]||
"";for(z=l[3];l=G[w++];)u[D]&&(u[D](l,r,z)||"class"===r&&u[D](l,"className",z))&&(x[p++]=l);x=p?x:[];break;default:x=ka((x=l.getElementsByTagName(r)).length?x:[])}else{for(var qa=r.split(c),P=qa.length-1,K=!!P,H,I,A,J,Q,R,S,T,N,y,E,M;p=qa[P--];){I=(H=p.replace(d,"$1%").replace(e,"$1&").replace(f," $1 ").split(g)).length;w=0;J=" ";for(G=l instanceof DocumentFragment?l.children:[l];A=H[w++];)if(" "!==A&&">"!==A&&"~"!==A&&"+"!==A&&G){A=A.match(h);Q=A[1]||"*";R=A[2];S=A[3]?" "+A[3]+" ":"";r=A[4];D=A[5]||
"";t=A[7];B="nth-child"===t||"nth-last-child"===t?k.exec("even"===A[8]&&"2n"||"odd"===A[8]&&"2n%1"||!C.test(A[8])&&"0n%"+A[8]||A[8]):A[8];T=[];p=N=0;for(E=w===I;y=G[N++];)switch(J){case " ":if(y.getElementsByTagName)for(M=y.getElementsByTagName(Q),y=0;z=M[y++];)R&&z.id!==R||S&&-1==(" "+z.className+" ").indexOf(S)||!(!r||u[D]&&(u[D](z,r,A[6])||"class"===r&&u[D](z,"className",A[6])))||z.yeasss||(F[t]?F[t](z,B):t)||(E&&(z.yeasss=1),T[p++]=z);break;case "~":for(Q=Q.toLowerCase();(y=y.nextSibling)&&!y.yeasss;)1!==
y.nodeType||"*"!==Q&&y.nodeName.toLowerCase()!==Q||R&&y.id!==R||S&&-1===(" "+y.className+" ").indexOf(S)||!(!r||u[D]&&(u[D](z,r,A[6])||"class"===r&&u[D](z,"className",A[6])))||y.yeasss||(F[t]?F[t](y,B):t)||(E&&(y.yeasss=1),T[p++]=y);break;case "+":for(;(y=y.nextSibling)&&1!==y.nodeType;);!y||y.nodeName.toLowerCase()!==Q.toLowerCase()&&"*"!==Q||R&&y.id!==R||S&&-1===(" "+z.className+" ").indexOf(S)||!(!r||u[D]&&(u[D](z,r,A[6])||"class"===r&&u[D](z,"className",A[6])))||y.yeasss||(F[t]?F[t](y,B):t)||
(E&&(y.yeasss=1),T[p++]=y);break;case ">":if(y.getElementsByTagName)for(M=y.getElementsByTagName(Q),w=0;z=M[w++];)z.parentNode!==y||R&&z.id!==R||S&&-1==(" "+z.className+" ").indexOf(S)||!(!r||u[D]&&(u[D](z,r,A[6])||"class"===r&&u[D](z,"className",A[6])))||z.yeasss||(F[t]?F[t](z,B):t)||(E&&(z.yeasss=1),T[p++]=z)}G=T}else J=A;if(K){if(!G.concat){T=[];for(y=0;z=G[y];)T[y++]=z;G=T}x=G.concat(1===x.length?x[0]:x)}else x=G}for(p=x.length;p--;)x[p].yeasss=x[p].nodeIndex=x[p].nodeIndexLast=null}return x};
w.is=function(a,c){c=w(c,a.parentNode);var b;var d=-1;for(b=c.length;++d<b;)if(c[d]===a)return!0;return!1};return w}(),fa=function(){var b=["0","0","0"];return function(){for(var a=b.length,c;a;){a--;c=b[a].charCodeAt(0);if(57==c)return b[a]="A",b.join("");if(90==c)b[a]="0";else return b[a]=String.fromCharCode(c+1),b.join("")}b.unshift("0");return b.join("")}}(),ma=function(b,a){this.name=b;this.listeners=[];this.map={};this.hash=fa();this.uni="$$"+b+"_"+this.hash;this.suspended=!1;this.lid=0;"object"===
typeof a&&null!==a?p(this,a,!0,!1):this.returnResult=a};p(ma.prototype,{name:null,listeners:null,map:null,hash:null,uni:null,suspended:!1,lid:null,returnResult:null,autoTrigger:null,lastTrigger:null,triggerFilter:null,filterContext:null,expectPromises:!1,resolvePromises:!1,getName:function(){return this.name},destroy:function(){for(var b in this)this[b]=null},on:function(b,a,c){if(!b)return null;a=a||null;c=c||{};var d=this.uni,e=b||a;if(e[d]&&!c.allowDupes)return null;var f=++this.lid,g=c.first||
!1;e[d]=f;b={fn:b,context:a,uniContext:e,id:f,async:!1,called:0,limit:0,start:1,count:0,append:null,prepend:null};p(b,c,!0,!1);!0===b.async&&(b.async=1);g?this.listeners.unshift(b):this.listeners.push(b);this.map[f]=b;if(this.autoTrigger&&this.lastTrigger&&!this.suspended){var h=this.triggerFilter;this.triggerFilter=function(a){return a.id===f?h?!1!==h(a):!0:!1};this.trigger.apply(this,this.lastTrigger);this.triggerFilter=h}return f},once:function(b,a,c){c=c||{};c.limit=1;return this.on(b,a,c)},un:function(b,
a){var c=-1,d=this.uni,e=this.listeners;b=b==parseInt(b)?parseInt(b):(a||b)[d];if(!b)return!1;a=0;for(var f=e.length;a<f;a++)if(e[a].id===b){c=a;delete e[a].uniContext[d];break}if(-1===c)return!1;e.splice(c,1);delete this.map[b];return!0},hasListener:function(b,a){var c=this.listeners;if(b){a=a||b;b=w(b)?a[this.uni]:parseInt(b);if(!b)return!1;a=0;for(var d=c.length;a<d;a++)if(c[a].id===b)return!0;return!1}return 0<c.length},removeAllListeners:function(){var b=this.listeners,a=this.uni,c;var d=0;for(c=
b.length;d<c;d++)delete b[d].uniContext[a];this.listeners=[];this.map={}},suspend:function(){this.suspended=!0},resume:function(){this.suspended=!1},_prepareArgs:function(b,a){if(b.append||b.prepend)a=E.call(a),b.prepend&&(a=b.prepend.concat(a)),b.append&&(a=a.concat(b.append));return a},trigger:function(){var b=this,a=b.listeners,c=b.returnResult,d=b.triggerFilter,e=b.filterContext,f=b.expectPromises,g=[],h;if(b.suspended)return null;b.autoTrigger&&(b.lastTrigger=E.call(arguments));if(0===a.length)return null;
var k="all"===c||"concat"===c?[]:"merge"===c?{}:null,C,n;for(C="first"===c?[a[0]]:E.call(a);n=C.shift();)if(!(!n||!b.map[n.id]||(a=b._prepareArgs(n,arguments),d&&!1===d.call(e,n,a,b))||n.filter&&!1===n.filter.apply(n.filterContext||n.context,a)||(n.count++,n.count<n.start))){if(n.async&&!f){var m=null;X(n.fn,n.context,a,n.async)}else f?(m=function(a,c,d){return function(e){"pipe"===c&&(d[0]=e,d=b._prepareArgs(a,d));return a.fn.apply(a.context,d)}}(n,c,E.call(arguments)),m=h?h.then(m):n.fn.apply(n.context,
a),m.catch(function(a){console.log(a)})):m=n.fn.apply(n.context,a);n.called++;n.called===n.limit&&b.un(n.id);if("first"===c)return m;if(f)g.push(m),"pipe"===c&&m&&(h=m);else if(null!==c)if("all"===c)k.push(m);else if("concat"===c&&m)k=k.concat(m);else if("merge"===c)p(k,m,!0,!1);else{if("nonempty"===c&&m)return m;if("pipe"===c)k=m,arguments[0]=m;else if("last"===c)k=m;else{if(!1===c&&!1===m)return!1;if(!0===c&&!0===m)return!0}}}return f?(d=W.all(g),b.resolvePromises&&null!==c&&"all"!==c&&(d=d.then(function(a){var b,
d=a.length;for(b=0;b<d;b++){var e=a[b];if("concat"===c&&e)k=k.concat(e);else if("merge"===c)p(k,e,!0,!1);else{if("nonempty"===c&&e)return e;if(!1===c&&!1===e)return!1;if(!0===c&&!0===e)return!0}}return k})),d):k}},!0,!1);var na=function(){this.events={}};p(na.prototype,{createEvent:function(b,a){b=b.toLowerCase();var c=this.events;c[b]||(c[b]=new ma(b,a));return c[b]},getEvent:function(b){b=b.toLowerCase();return this.events[b]},on:function(b,a,c,d){b=b.toLowerCase();var e=this.events;e[b]||(e[b]=
new ma(b));return e[b].on(a,c,d)},once:function(b,a,c,d){d=d||{};d.limit=1;return this.on(b,a,c,d)},un:function(b,a,c){b=b.toLowerCase();var d=this.events;d[b]&&d[b].un(a,c)},relayEvent:function(b,a){b.on(a,this.trigger,this,{prepend:"*"===a?null:[a]})},unrelayEvent:function(b,a){b.un(a,this.trigger,this)},hasListener:function(b,a,c){var d=this.events;if(b)return b=b.toLowerCase(),d[b]?a?d[b].hasListener(a,c):!0:!1;for(b in d)if(d[b].hasListener())return!0;return!1},hasEvent:function(b){return!!this.events[b]},
removeAllListeners:function(b){var a=this.events;if(b)a[b]&&a[b].removeAllListeners();else for(b in a)a[b].removeAllListeners()},trigger:function(){var b=arguments[0],a=this.events,c=null;b=b.toLowerCase();if(a[b]){var d=a[b];c=d.trigger.apply(d,E.call(arguments,1))}(d=a["*"])&&d.trigger.apply(d,arguments);return c},suspendEvent:function(b){b=b.toLowerCase();var a=this.events;a[b]&&a[b].suspend()},suspendAllEvents:function(){var b=this.events,a;for(a in b)b[a].suspend()},resumeEvent:function(b){b=
b.toLowerCase();var a=this.events;a[b]&&a[b].resume()},resumeAllEvents:function(){var b=this.events,a;for(a in b)b[a].resume()},destroyEvent:function(b){var a=this.events;a[b]&&(a[b].removeAllListeners(),a[b].destroy(),delete a[b])},destroy:function(){var b=this.events,a;for(a in b)this.destroyEvent(a);for(a in this)this[a]=null},getApi:function(){if(!this.api){for(var b="createEvent getEvent on un once hasListener removeAllListeners trigger suspendEvent suspendAllEvents resumeEvent resumeAllEvents destroyEvent relayEvent unrelayEvent".split(" "),
a={},c,d=-1,e=b.length;++d<e;c=b[d],a[c]=l(this[c],this));this.api=a}return this.api}},!0,!1);var Z=function(){var b=[],a=function(a){var c;var e=0;for(c=b.length;e<c;e++)if(!1===b[e][0].call(b[e][1],a))return;e=(a?a.stack:null)||Error().stack;if("undefined"!=typeof console&&console.error)a&&console.error(a),e&&console.error(e);else throw a;};a.on=function(c,d){a.un(c,d);b.push([c,d])};a.un=function(a,d){var c;var f=0;for(c=b.length;f<c;f++)if(b[f][0]===a&&b[f][1]===d){b.splice(f,1);break}};return a}(),
W=function(){var b=[],a=!1,c="undefined"!==typeof process?process.nextTick:function(a){setTimeout(a,0)},d=function(){a=!0;var e=b.shift();c(function(){e[0].apply(e[1],e[2]);b.length?d():a=!1},0)},e=function(c,e,f){f=f||[];b.push([c,e,f]);a||d()},f=function(a,c){return function(b){try{c.resolve(a(b))}catch(n){c.reject(n)}}},g=function(a,c){if(a instanceof g)return a;if(!(this instanceof g))return new g(a,c);var b;this._fulfills=[];this._rejects=[];this._dones=[];this._fails=[];if(0<arguments.length)if(b=
N(a))a instanceof g?a.then(l(this.resolve,this),l(this.reject,this)):(new g(b,a)).then(l(this.resolve,this),l(this.reject,this));else if(w(a))try{a.call(c,l(this.resolve,this),l(this.reject,this))}catch(n){this.reject(n)}else this.resolve(a)};p(g.prototype,{_state:0,_fulfills:null,_rejects:null,_dones:null,_fails:null,_wait:0,_value:null,_reason:null,_triggered:!1,isPending:function(){return 0===this._state},isFulfilled:function(){return 1===this._state},isResolved:function(){return 1===this._state},
isRejected:function(){return 2===this._state},hasListeners:function(){var a=[this._fulfills,this._rejects,this._dones,this._fails],c;var b=0;for(c=a.length;b<c;b++)if(a[b]&&a[b].length)return!0;return!1},_cleanup:function(){this._fails=this._dones=this._rejects=this._fulfills=null},_processValue:function(a,c){var b;if(0===this._state)if(a===this)this._doReject(new TypeError("cannot resolve promise with itself"));else{try{if(b=N(a)){a instanceof g?a.then(l(this._processResolveValue,this),l(this._processRejectReason,
this)):(new g(b,a)).then(l(this._processResolveValue,this),l(this._processRejectReason,this));return}}catch(n){0===this._state&&this._doReject(n);return}c.call(this,a)}},_callResolveHandlers:function(){this._done();for(var a=this._fulfills,c;c=a.shift();)e(c[0],c[1],[this._value]);this._cleanup()},_doResolve:function(a){this._value=a;this._state=1;0===this._wait&&this._callResolveHandlers()},_processResolveValue:function(a){this._processValue(a,this._doResolve)},resolve:function(a){if(this._triggered)return this;
this._triggered=!0;this._processResolveValue(a);return this},_callRejectHandlers:function(){this._fail();for(var a=this._rejects,c;c=a.shift();)e(c[0],c[1],[this._reason]);this._cleanup()},_doReject:function(a){this._state=2;this._reason=a;0===this._wait&&this._callRejectHandlers()},_processRejectReason:function(a){this._processValue(a,this._doReject)},reject:function(a){if(this._triggered)return this;this._triggered=!0;this._processRejectReason(a);return this},then:function(a,c,b){var d=new g,h=
this._state;b&&(a&&(a=l(a,b)),c&&(c=l(c,b)));0===h||0!==this._wait?(a&&w(a)?this._fulfills.push([f(a,d),null]):this._fulfills.push([d.resolve,d]),c&&w(c)?this._rejects.push([f(c,d),null]):this._rejects.push([d.reject,d])):1===h?a&&w(a)?e(f(a,d),null,[this._value]):d.resolve(this._value):2===h&&(c&&w(c)?e(f(c,d),null,[this._reason]):d.reject(this._reason));return d},"catch":function(a){return this.then(null,a)},_done:function(){for(var a=this._dones,c;c=a.shift();)try{c[0].call(c[1]||null,this._value)}catch(C){Z(C)}},
done:function(a,c){var b=this._state;if(1===b&&0===this._wait)try{a.call(c||null,this._value)}catch(n){Z(n)}else 0===b&&this._dones.push([a,c]);return this},_fail:function(){for(var a=this._fails,c;c=a.shift();)try{c[0].call(c[1]||null,this._reason)}catch(C){Z(C)}},fail:function(a,c){var b=this._state;if(2===b&&0===this._wait)try{a.call(c||null,this._reason)}catch(n){Z(n)}else 0===b&&this._fails.push([a,c]);return this},always:function(a,c){this.done(a,c);this.fail(a,c);return this},promise:function(){return{then:l(this.then,
this),done:l(this.done,this),fail:l(this.fail,this),always:l(this.always,this)}},after:function(a){var c=this;if(N(a)){c._wait++;var b=function(){c._wait--;0===c._wait&&0!==c._state&&(1===c._state?c._callResolveHandlers():c._callRejectHandlers())};w(a.done)?a.done(b):a.then(b)}return c}},!0,!1);g.fcall=function(a,c,b){return g.resolve(a.apply(c,b||[]))};g.resolve=function(a){var c=new g;c.resolve(a);return c};g.reject=function(a){var c=new g;c.reject(a);return c};g.all=function(a){if(!a.length)return g.resolve(null);
var c=new g,b=a.length,d=Array(b),e=b,f,h,L=function(a,b){d[b]=a;e--;0===e&&c.resolve(d)};for(f=0;f<b;f++)(function(b){h=a[f];h instanceof g?h.done(function(a){L(a,b)}).fail(c.reject,c):N(h)||w(h)?(new g(h)).done(function(a){L(a,b)}).fail(c.reject,c):L(h,b)})(f);return c};g.when=function(){return g.all(arguments)};g.allResolved=function(a){if(!a.length)return g.resolve(null);var c=new g,b=a.length,d=[],e=b,f,h=function(a){d.push(a);L()},L=function(){e--;0===e&&c.resolve(d)};for(f=0;f<b;f++){var l=
a[f];l instanceof g?l.done(h).fail(L):N(l)||w(l)?(new g(l)).done(h).fail(L):h(l)}return c};g.race=function(a){if(!a.length)return g.resolve(null);var c=new g,b=a.length,d;for(d=0;d<b;d++){var e=a[d];e instanceof g?e.done(c.resolve,c).fail(c.reject,c):N(e)||w(e)?(new g(e)).done(c.resolve,c).fail(c.reject,c):c.resolve(e);if(!c.isPending())break}return c};g.waterfall=function(a){if(!a.length)return g.resolve(null);var c=a.shift();c=w(c)?g.fcall(c):g.resolve(b);for(var b;b=a.shift();)N(b)?c=c.then(function(a){return function(){return a}}(b)):
w(b)?c=c.then(b):c.resolve(b);return c};g.forEach=function(a,c,b,d){var e=a.slice(),f=new g,h=[],k=0,l=function(){if(e.length){var a=e.shift(),v=k;k++;g.fcall(c,b,[a,v]).done(function(a){h.push(a);l()}).fail(function(a){d?f.reject(a):(h.push(null),l())})}else f.resolve(h)};l();return f};g.counter=function(a){var c=new g;c.countdown=function(){a--;0===a&&c.resolve()};return c};return g}(),ta=function(){function b(a,e,f){var d;if(J(e)){var h=0;for(d=e.length;h<d;h++){var k=e[h];c.test(a)?f(a,k):b(a+
"["+("object"===typeof k?h:"")+"]",k,f)}}else if(V(e))for(h in e)b(a+"["+h+"]",e[h],f);else f(a,e)}var a=/%20/g,c=/\[\]$/;return function(c){var d,f=[],g=function(a,c){c=w(c)?c():null==c?"":c;f[f.length]=encodeURIComponent(a)+"="+encodeURIComponent(c)};for(d in c)b(d,c[d],g);return f.join("&").replace(a,"+")}}();Y.register("mixin.Promise",{$$promise:null,$beforeInit:function(){this.$$promise=new W},then:function(){return this.$$promise.then.apply(this.$$promise,arguments)},done:function(){this.$$promise.done.apply(this.$$promise,
arguments);return this},always:function(){this.$$promise.always.apply(this.$$promise,arguments);return this},fail:function(){this.$$promise.fail.apply(this.$$promise,arguments);return this}});(function(){var b={xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain",_default:"*/*"};return M({$class:"ajax.transport.XHR",type:"xhr",_xhr:null,_deferred:null,_ajax:null,$init:function(a,c,b){var d;window.XMLHttpRequest&&
(d=new XMLHttpRequest)||(d=new ActiveXObject("Msxml2.XMLHTTP"));this._xhr=d;this._deferred=c;this._opt=a;this._ajax=b;a.progress&&(d.onprogress=l(a.progress,a.context));a.uploadProgress&&d.upload&&(d.upload.onprogress=l(a.uploadProgress,a.context));d.onreadystatechange=l(this.onReadyStateChange,this)},setHeaders:function(){var a=this._opt,c=this._xhr,d;if(a.xhrFields)for(d in a.xhrFields)c[d]=a.xhrFields[d];a.data&&a.contentType&&c.setRequestHeader("Content-Type",a.contentType);c.setRequestHeader("X-Requested-With",
"XMLHttpRequest");c.setRequestHeader("Accept",a.dataType&&b[a.dataType]?b[a.dataType]+", */*; q=0.01":b._default);for(d in a.headers)c.setRequestHeader(d,a.headers[d])},onReadyStateChange:function(){var a=this._xhr,c=this._deferred;if(0===a.readyState)a.onreadystatechange=t,c.resolve(a);else if(4===a.readyState){a.onreadystatechange=t;a:{try{var b=!a.status&&location&&"file:"==location.protocol||200<=a.status&&300>a.status||304===a.status||1223===a.status;break a}catch(e){}b=!1}if(b)this._ajax.processResponse(u(a.responseText)?
a.responseText:void 0,a.getResponseHeader("content-type")||"");else{a.responseData=null;try{a.responseData=this._ajax.returnResponse(u(a.responseText)?a.responseText:void 0,a.getResponseHeader("content-type")||"")}catch(e){}c.reject(a)}}},abort:function(){this._xhr.onreadystatechange=t;this._xhr.abort()},send:function(){var a=this._opt;try{this._xhr.open(a.method,a.url,!0,a.username,a.password),this.setHeaders(),this._xhr.send(a.data)}catch(c){this._deferred&&this._deferred.reject(c)}}})})();var aa=
function(b){if(b instanceof aa)return b;if(!(this instanceof aa))return new aa(b);for(var a in b)if(!this[a])try{this[a]=b[a]}catch(e){}this.originalEvent=b;this.type=b.type;!this.target&&b.srcElement&&(this.target=b.srcElement);var c=b.button;if(void 0===this.pageX&&null!==b.clientX){var d=this.target?this.target.ownerDocument||window.document:window.document;a=d.documentElement;d=d.body;this.pageX=b.clientX+(a&&a.scrollLeft||d&&d.scrollLeft||0)-(a&&a.clientLeft||d&&d.clientLeft||0);this.pageY=b.clientY+
(a&&a.scrollTop||d&&d.scrollTop||0)-(a&&a.clientTop||d&&d.clientTop||0)}this.which||void 0===c||(this.which=c&1?1:c&2?3:c&4?2:0);this.isDefaultPrevented=b.defaultPrevented||void 0===b.defaultPrevented&&!1===b.returnValue?ea:da;this.timeStamp=b&&b.timeStamp||(new Date).getTime()};p(aa.prototype,{isDefaultPrevented:da,isPropagationStopped:da,isImmediatePropagationStopped:da,preventDefault:function(){var b=this.originalEvent;this.isDefaultPrevented=ea;b.returnValue=!1;b&&b.preventDefault&&b.preventDefault()},
stopPropagation:function(){var b=this.originalEvent;this.isPropagationStopped=ea;b.cancelBubble=!0;b&&b.stopPropagation&&b.stopPropagation()},stopImmediatePropagation:function(){var b=this.originalEvent;this.isImmediatePropagationStopped=ea;b&&b.stopImmediatePropagation&&b.stopImmediatePropagation();this.stopPropagation()}},!0,!1);var ua=function(b){function a(){d=null}var c,d;b=function(b){return function(e){var f=new aa(e||window.event),h=E.call(arguments,1),k=0,l=0,n=0,m=0;f.type="mousewheel";
"detail"in f&&(l=-1*f.detail);"wheelDelta"in f&&(l=f.wheelDelta);"wheelDeltaY"in f&&(l=f.wheelDeltaY);"wheelDeltaX"in f&&(k=-1*f.wheelDeltaX);"axis"in f&&f.axis===f.HORIZONTAL_AXIS&&(k=-1*l,l=0);var v=0===l?k:l;"deltaY"in f&&(v=l=-1*f.deltaY);"deltaX"in f&&(k=f.deltaX,0===l&&(v=-1*k));if(0!==l||0!==k){var q=Math.max(Math.abs(l),Math.abs(k));if(!d||q<d)d=q,"mousewheel"===f.type&&0===q%120&&(d/=40);"mousewheel"===f.type&&0===q%120&&(v/=40,k/=40,l/=40);v=Math[1<=v?"floor":"ceil"](v/d);k=Math[1<=k?"floor":
"ceil"](k/d);l=Math[1<=l?"floor":"ceil"](l/d);this.getBoundingClientRect&&(q=this.getBoundingClientRect(),n=f.clientX-q.left,m=f.clientY-q.top);f.deltaX=k;f.deltaY=l;f.deltaFactor=d;f.offsetX=n;f.offsetY=m;f.deltaMode=0;h.unshift(f,v,k,l);c&&clearTimeout(c);c=setTimeout(a,200);return b.apply(this,h)}}};b.events=function(){var a=window.document;return"onwheel"in a||9<=a.documentMode?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"]};return b}(),ha=function(){var b=null,a=null;return function(c,
d,e){null===b&&(c.addEventListener?(b="addEventListener",a=""):(b="attachEvent",a="on"));if("mousewheel"==d){e=ua(e);d=ua.events();var f;var g=0;for(f=d.length;g<f;g++)c[b](a+d[g],e,!1)}else c[b](a+d,e,!1);return e}}();M({$class:"ajax.transport.Script",type:"script",_opt:null,_deferred:null,_ajax:null,_el:null,$init:function(b,a,c){this._opt=b;this._ajax=c;this._deferred=a},send:function(){var b=document.createElement("script");b.setAttribute("async","async");b.setAttribute("charset","utf-8");b.setAttribute("src",
this._opt.url);ha(b,"load",l(this.onLoad,this));ha(b,"error",l(this.onError,this));document.head.appendChild(b);this._el=b},onLoad:function(b){this._deferred&&this._deferred.resolve(b)},onError:function(b){this._deferred.reject(b)},abort:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el)},destroy:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el)}});M({$class:"ajax.transport.IFrame",type:"iframe",_opt:null,_deferred:null,_ajax:null,_el:null,_sent:!1,$init:function(b,
a,c){this._opt=b;this._ajax=c;this._deferred=a},send:function(){var b=this,a=document.createElement("iframe"),c="frame-"+fa(),d=b._opt.form;a.setAttribute("id",c);a.setAttribute("name",c);a.style.display="none";document.body.appendChild(a);d.setAttribute("action",b._opt.url);d.setAttribute("target",c);ha(a,"load",l(b.onLoad,b));ha(a,"error",l(b.onError,b));b._el=a;var e=0,f=function(){e++;try{d.submit(),b._sent=!0}catch(g){2<e?b._deferred.reject(g):X(f,null,[],1E3)}};f()},onLoad:function(){var b=
this._el;if(this._sent&&this._opt&&!this._opt.jsonp)try{var a=b.contentDocument||b.contentWindow.document;var c=a.body.innerHTML;this._ajax.processResponse(c)}catch(d){this._deferred.reject(d)}},onError:function(b){this._sent&&this._deferred.reject(b)},abort:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el)},destroy:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el)}});(function(){var b=/\?/,a=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,
c=/#.*$/,d=/([?&])_=[^&]*/,e=new na,f=!(!window||!window.FormData),g=function(a,c,b){var d=c?c.dataType:null;c=c?c.selector:null;if(!u(a))return a;b=b||"";if("xml"===d||!d&&0<=b.indexOf("xml"))return a=pa(ra(a)),c?sa(c,a):a;if("html"===d)return a=pa(a,"text/html"),c?sa(c,a):a;if("fragment"==d){b=document.createDocumentFragment();d=document.createElement("div");for(d.innerHTML=a;d.firstChild;)b.appendChild(d.firstChild);return b}if("json"===d||!d&&0<=b.indexOf("json"))return Aa(ra(a));("script"===
d||!d&&0<=b.indexOf("javascript"))&&m(a);return a+""},h=function(a){return"/"==a.substr(0,1)?location.protocol+"//"+location.host+a:a},k=function(a,e){a.replace(c,"");if(!e.allowCache){var g=(new Date).getTime();a=d.test(a)?a.replace(d,"$1_="+g):a+(b.test(a)?"&":"?")+"_="+g}!e.data||"POST"==e.method||e.contentType||f&&e.data instanceof window.FormData||(e.data=u(e.data)?e.data:ta(e.data),a+=(b.test(a)?"&":"?")+e.data,e.data=null);return a},p=function(a,c,b){var d;if(!ca(a)&&!w(a)&&b){var e=document.createElement("input");
e.setAttribute("type","hidden");e.setAttribute("name",b);e.setAttribute("value",a);c.appendChild(e)}else if(J(a)&&b)for(e=0,d=a.length;e<d;e++)p(a[e],c,b+"["+e+"]");else if(ca(a))for(e in a)a.hasOwnProperty(e)&&p(a[e],c,b?b+"["+e+"]":e)},n=function(a){for(var c,b,d={},e=0;e<a.elements.length;e++)if(c=a.elements[e],null!==B(c,"name"))if(b="INPUT"===c.nodeName.toUpperCase()?B(c,"type").toUpperCase():"TEXT","FILE"===b)for(b=0;b<c.files.length;d[c.name]=c.files[b++].name);else if("RADIO"!==b&&"CHECKBOX"!==
b||c.checked)d[c.name]=c.value;return ta(d)},m=function(a){var c=eval;a&&(/^[^\S]*use strict/.test(a)?(c=document.createElement("script"),c.text=a,document.head.appendChild(c).parentNode.removeChild(c)):c(a))};M({$class:"Ajax",$mixins:["mixin.Promise"],_jsonpName:null,_transport:null,_opt:null,_deferred:null,_promise:null,_timeout:null,_form:null,_removeForm:!1,$init:function(c){c.url&&(c.url=h(c.url));var b=a.exec((window?window.location.href:"").toLowerCase())||[],d=a.exec(c.url.toLowerCase());
this._opt=c;!0!==c.crossDomain&&!0!==c.ignoreCrossDomain&&(c.crossDomain=!(!d||d[1]===b[1]&&d[2]===b[2]&&(d[3]||("http:"===d[1]?"80":"443"))===(b[3]||("http:"===b[1]?"80":"443"))));var g;c.files&&!f&&(c.transport="iframe");"iframe"!=c.transport||c.form?c.form&&(this._form=c.form,"POST"!=c.method||f||(c.transport="iframe")):(this.createForm(),c.form=this._form);if(c.form&&"iframe"!=c.transport&&"POST"==c.method)f?c.data=new FormData(c.form):(c.contentType="application/x-www-form-urlencoded",c.data=
n(c.form));else if("json"==c.contentType)c.contentType=c.contentTypeHeader||"text/plain",c.data=u(c.data)?c.data:JSON.stringify(c.data);else if(V(c.data)&&"POST"==c.method&&f)for(g in b=c.data,c.data=new FormData,b)c.data.append(g,b[g]);c.files&&this.importFiles();c.url=k(c.url,c);this._transport=g=!c.crossDomain&&"script"!=c.transport||c.form?"iframe"==c.transport?new K.ajax.transport.IFrame(c,this.$$promise,this):new K.ajax.transport.XHR(c,this.$$promise,this):new K.ajax.transport.Script(c,this.$$promise,
this);this.$$promise.done(function(a){e.trigger("success",a)});this.$$promise.fail(function(a){e.trigger("error",a)});this.$$promise.always(function(){e.trigger("end")});e.trigger("start");c.timeout&&(this._timeout=setTimeout(l(this.onTimeout,this),c.timeout));c.jsonp&&this.createJsonp();!1===e.trigger("before-send",c,g)&&this.$$promise.reject();c.beforeSend&&!1===c.beforeSend.call(c.context,c,g)&&this.$$promise.reject();this.$$promise.isPending()?(X(g.send,g),this.$$promise.always(this.asyncDestroy,
this)):X(this.asyncDestroy,this,[],1E3)},asyncDestroy:function(){this.$isDestroyed()||(this.$$promise.hasListeners()?X(this.asyncDestroy,this,[],1E3):this.$destroy())},abort:function(a){this.$$promise.reject(a||"abort");this._transport.abort();return this},onTimeout:function(){this.abort("timeout")},getTransport:function(){return this._transport},createForm:function(){var a=document.createElement("form");a.style.display="none";a.setAttribute("method",this._opt.method);a.setAttribute("enctype","multipart/form-data");
p(this._opt.data,a,null);document.body.appendChild(a);this._form=a;this._removeForm=!0},importFiles:function(){var a=this._opt,c=a.files,b=this._form;a=a.data;var d,e;var f=0;for(d=c.length;f<d;f++){var g=c[f];if(J(g)){var h=g[0];g=g[1]}else h=window.File&&g instanceof File?g.uploadName||"upload"+(1<d?"[]":""):g.name||"upload"+(1<d?"[]":"");if(!(window.File&&g instanceof File)){var k=g;g=null}if(b)k&&b.appendChild(k);else if(g)a.append(h,g);else if(k.files&&k.files.length)for(g=0,e=k.files.length;g<
e;g++)a.append(h,k.files[g])}},createJsonp:function(){var a=this._opt,c=a.jsonpParam||"callback",d=a.jsonpCallback||"jsonp_"+fa();a.url+=(b.test(a.url)?"&":"?")+c+"="+d;this._jsonpName=d;"undefined"!=typeof window&&(window[d]=l(this.jsonpCallback,this));"undefined"!=typeof global&&(global[d]=l(this.jsonpCallback,this));return d},jsonpCallback:function(a){try{var c=this.processResponseData(a)}catch(L){this.$$promise?this.$$promise.reject(L):Z(L)}this.$$promise&&this.$$promise.resolve(c)},processResponseData:function(a,
c){var b=this._opt;a=g(a,b,c);e.hasListener("process-response")&&e.trigger("process-response",a,this.$$promise);b.processResponse&&(a=b.processResponse.call(b.context,a,this.$$promise));return a},returnResponse:function(a,c){return this._opt.jsonp?null:this.processResponseData(a,c)},processResponse:function(a,c){var b=this.$$promise;if(this._opt.jsonp)if(a){try{m(a)}catch(F){b.reject(F)}b.isPending()&&b.reject("jsonp script didn't invoke callback")}else b.reject("jsonp script is empty");else{try{var d=
this.processResponseData(a,c)}catch(F){b.reject(F)}b.resolve(d)}},destroy:function(){this._timeout&&clearTimeout(this._timeout);this._form&&this._form.parentNode&&this._removeForm&&this._form.parentNode.removeChild(this._form);this._transport.$destroy();this._jsonpName&&("undefined"!=typeof window&&delete window[this._jsonpName],"undefined"!=typeof global&&delete global[this._jsonpName])}},{prepareUrl:k,global:e})})();var oa=function(){var b={url:null,data:null,method:"GET",headers:null,username:null,
password:null,cache:null,dataType:null,timeout:0,contentType:null,xhrFields:null,jsonp:!1,jsonpParam:null,jsonpCallback:null,transport:null,replace:!1,selector:null,form:null,beforeSend:null,progress:null,uploadProgress:null,processResponse:null,context:null},a={},c=function(c,e){e=e||{};c&&!u(c)?e=c:e.url=c;if(!e.url&&(e.form&&(e.url=B(e.form,"action")),!e.url))throw"Must provide url";p(e,a,!1,!0);p(e,b,!1,!0);e.method=e.method?e.method.toUpperCase():e.form?B(e.form,"method").toUpperCase()||"GET":
"GET";return new K.Ajax(e)};c.setup=function(c){p(a,c,!0,!0)};c.on=function(){K.Ajax.global.on.apply(K.Ajax.global,arguments)};c.un=function(){K.Ajax.global.un.apply(K.Ajax.global,arguments)};c.get=function(a,b){b=b||{};b.method="GET";return c(a,b)};c.post=function(a,b){b=b||{};b.method="POST";return c(a,b)};c.load=function(a,b,f){f=f||{};u(b)||(f=b);f.dataType="fragment";return c(b,f).done(function(c){if(f.replace)for(;a.firstChild;)a.removeChild(a.firstChild);a.appendChild(c)})};c.loadScript=function(a){return c(a,
{transport:"script"})};c.submit=function(a,b){b=b||{};b.form=a;return c(null,b)};c.prepareUrl=function(a,c){return K.Ajax.prepareUrl(a,c||{})};return c}(),ia=H.factory;Y.register("mixin.Observable",{$$observable:null,$$callbackContext:null,$$events:null,$beforeInit:function(b){this.$$observable=new na;this.$initObservable(b)},$initObservable:function(b){var a=this.$$observable,c;if(b&&b.callback){var d=b.callback,e=d.context||d.scope||d.$context,f=p({},this.$$events,d.$events,!0,!1);for(c in f)a.createEvent(c,
f[c]);d.context=null;d.scope=null;for(c in d)if(d[c])a.on(c,d[c],e||this);b.callback=null;e&&(this.$$callbackContext=e)}else if(this.$$events)for(c in this.$$events)a.createEvent(c,this.$$events[c])},on:function(){var b=this.$$observable;return b?b.on.apply(b,arguments):null},un:function(){var b=this.$$observable;return b?b.un.apply(b,arguments):null},once:function(){var b=this.$$observable;return b?b.once.apply(b,arguments):null},trigger:function(){var b=this.$$observable;return b?b.trigger.apply(b,
arguments):null},$beforeDestroy:function(){this.$$observable.trigger("before-destroy",this)},$afterDestroy:function(){this.$$observable.trigger("destroy",this);this.$$observable.destroy();this.$$observable=null}});var I=function(){var b={},a={};return M({$class:"Model",$mixins:["mixin.Observable"],type:null,fields:null,record:null,store:null,plain:!1,lastAjaxResponse:null,$init:function(a){this.fields||(this.fields={});p(this,{record:{load:null,save:null,"delete":null,id:null,data:null,success:null,
extra:{}},store:{load:null,save:null,"delete":null,id:null,data:null,total:null,start:null,limit:null,success:null,extra:{}}},!1,!0);p(this,a,!0,!0);this.plain=!this.type},isPlain:function(){return this.plain},getRecordProp:function(a,b){return this.getProp("record",a,b)},setRecordProp:function(a,b){this.record[a]=b},getStoreProp:function(a,b){return this.getProp("store",a,b)},setStoreProp:function(a,b){this.store[a]=b},getProp:function(a,b,e){a=this[a];return a[b]&&a[b][e]||a[e]||this[e]||null},
setProp:function(a,b){return this[a]=b},_prepareRequestUrl:function(a,b){a=a.replace(/:([a-z0-9_\-]+)/gi,function(a,c){var d=b[c];return void 0!=d?(delete b[c],d):a});return/:([a-z0-9_\-]+)/.test(a)?null:a},_makeRequest:function(a,b,e,f){var c=this,d=c[a],k=p({},u(d[b])||w(d[b])?{url:d[b]}:d[b]),l=c.getProp(a,b,"id"),n=c.getProp(a,b,"root"),m=c.getProp(a,b,"url"),v=c.getProp(a,b,"json"),q={};if(!k)if(m)k={url:m};else throw a+"."+b+" not defined";if(u(k)||w(k))k={url:k};if(!k.url){if(!m)throw a+"."+
b+" url not defined";k.url=m}q.url=k.url;k.ajax&&p(q,k.ajax,!0,!1);if(k.validate&&(m=k.validate.call(c,e,f),!1===m))return W.reject(m);if(k.resolve){if((m=k.resolve.call(c,e,f))&&N(m))return m;if(m)return W.resolve(m)}q.data=p({},k.data,c.extra,d.extra,d[b]?d[b].extra:null,q.data,f,!0,!0);if(w(k.url)){e=k.url(q.data);var t=new W;e.then(function(d){"record"==a?c._processRecordResponse(b,d,t):"store"==a&&c._processStoreResponse(b,d,t)});return t}e&&l&&(q.data[l]=e);f&&n&&"load"!=b&&(q.data[n]=f);q.url=
c._prepareRequestUrl(q.url,q.data);if(!q.url)return W.reject();q.method||(q.method="controller"!=a?"load"==b?"GET":"POST":"GET");v&&q.data&&"GET"!=q.method&&(q.contentType="text/plain",q.data=JSON.stringify(q.data));q.context=c;if("record"==a){q.processResponse=function(a,d){c.lastAjaxResponse=a;c._processRecordResponse(b,a,d)};var B=c._processRecordRequest(oa(q),b,e,f)}else"store"==a?(q.processResponse=function(a,d){c.lastAjaxResponse=a;c._processStoreResponse(b,a,d)},B=c._processStoreRequest(oa(q),
b,e,f)):"controller"==a&&(q.processResponse=function(a,d){c.lastAjaxResponse=a;c._processControllerResponse(b,a,d)},B=c._processControllerRequest(oa(q),b,e,f));k.processRequest&&k.processRequest.call(c,B,e,f);return B},_processRecordRequest:function(a,b,e,f){return a},_processRecordResponse:function(a,b,e){var c=this.getRecordProp(a,"id"),d=this.getRecordProp(a,"root");c=(d=d?b[d]:b)&&d[c]||b[c];this._getSuccess("record",a,b)?e.resolve({id:c,data:this.extendPlainRecord(d)}):e.reject(b)},_processStoreRequest:function(a,
b,e,f){return a},_processStoreResponse:function(a,b,e){var c=this.getStoreProp(a,"root"),d=this.getStoreProp(a,"total");c=c?b[c]:b;d=d?b[d]:null;this._getSuccess("store",a,b)?e.resolve({data:c,total:d}):e.reject(b)},_processControllerRequest:function(a,b,e,f){return a},_processControllerResponse:function(a,b,e){this._getSuccess("controller",a,b)?e.resolve(b):e.reject(b)},_getSuccess:function(a,b,e){a=this.getProp(a,b,"success");return"function"==typeof a?a(e):a&&void 0!=e[a]?e[a]:!0},runController:function(a,
b,e){return this._makeRequest("controller",a,b,e)},loadRecord:function(a){return this._makeRequest("record","load",a)},saveRecord:function(a,b,e){return this._makeRequest("record",a.getId()?"save":"create",a.getId(),p({},a.storeData(a.getData(b)),e))},deleteRecord:function(a){return this._makeRequest("record","delete",a.getId())},loadStore:function(a,b){return this._makeRequest("store","load",null,b)},saveStore:function(a,b){return this._makeRequest("store","save",null,b)},deleteRecords:function(a,
b){return this._makeRequest("store","delete",b)},extendPlainRecord:function(a){var c=this.getRecordProp(null,"extend");return c?p(a,c,!1,!1):a},getFields:function(){return this.fields},getRecordId:function(a){var c=this.getRecordProp("load","id");return a[c]||null},restoreField:function(a,b,e){var c=this.fields[b];if(c){switch(u(c)?c:c.type){case "int":e=parseInt(e);break;case "bool":case "boolean":u(e)?(e=e.toLowerCase(),e=!("off"===e||"no"===e||"0"===e||"false"==e||"null"==e)):e=e?!0:!1;break;case "double":case "float":e=
parseFloat(e);break;case "date":c.parseFn?e=c.parseFn(e,c.format):Date.parse?e=Date.parse(e,c.format):("timestamp"==c.format&&(e=1E3*parseInt(e)),e=new Date(e))}c.restore&&(e=c.restore.call(a,e,b))}return this.onRestoreField(a,b,e)},onRestoreField:function(a,b,e){return e},storeField:function(a,b,e){var c=this.fields[b];if(c){switch(u(c)?c:c.type){case "bool":case "boolean":e=e?"1":"0";break;case "date":e=c.formatFn?c.formatFn(e,c.format):Date.format?Date.format(e,c.format):"timestamp"==c.format?
e.getTime()/1E3:e.format?e.format(c.format):e.toString();break;default:e=e.toString()}c.store&&(e=c.store.call(a,e,b))}return this.onStoreField(a,b,e)},onStoreField:function(a,b,e){return e}},{create:function(a,d){return"MetaphorJs.Model"===a?ia(a,d):d?ia(a,d):b[a]?b[a]:b[a]=ia(a)},addToCache:function(c){var b=c.$getClass(),e=c.getId();"MetaphorJs.Record"!=b&&(a[b]||(a[b]={}),a[b][e]=c)},getFromCache:function(c,b){return a[c]&&a[c][b]?a[c][b]:null},removeFromCache:function(c,b){a[c]&&a[c][b]&&delete a[c][b]}})}(),
U=M({$class:"Record",$mixins:["mixin.Observable"],id:null,data:null,orig:null,modified:null,loaded:!1,loading:!1,dirty:!1,model:null,standalone:!0,stores:null,importUponSave:!1,importUponCreate:!1,$init:function(b,a,c){var d=arguments.length;1==d?(c=b,a=b=null):2==d&&(c=a,a=null);this.data={};this.orig={};this.stores=[];this.modified={};c=c||{};this.$super(c);u(this.model)?this.model=I.create(this.model):this.model instanceof I||(this.model=new I(this.model));this.id=b;a?this.importData(a):!1!==c.autoLoad&&
b&&this.load();"MetaphorJs.Record"!=this.$getClass()&&I.addToCache(this)},isLoaded:function(){return this.loaded},isLoading:function(){return this.loading},isStandalone:function(){return this.standalone},isDirty:function(){return this.dirty},getModel:function(){return this.model},attachStore:function(b){b=b.getId();-1==this.stores.indexOf(b)&&this.stores.push(b)},detachStore:function(b){b=b.getId();var a;this.$destroyed||-1==(a=this.stores.indexOf(b))||(this.stores.splice(a,1),0!=this.stores.length||
this.standalone||this.$destroy())},setDirty:function(b){this.dirty!=b&&(this.dirty=!!b,this.trigger("dirty-change",this,b))},importData:function(b){var a={},c;if(b){for(c in b)a[c]=this.model.restoreField(this,c,b[c]);this.data=a}this.orig=p({},this.data);this.modified={};this.loaded=!0;this.setDirty(!1)},storeData:function(b){var a={},c;for(c in b)a[c]=this.model.storeField(this,c,b[c]);return a},getId:function(){return this.id},getData:function(b){var a={};if(b){var c;b=u(b)?[b]:b;var d=0;for(c=
b.length;d<c;d++)a[b[d]]=this.data[b[d]]}else for(d in b=this.data,b)"$"!=d.substr(0,1)&&(a[d]=b[d]);return a},getChanged:function(){return p({},this.modified)},isChanged:function(b){return this.modified[b]||!1},get:function(b){return this.data[b]},setId:function(b){!this.id&&b&&(this.id=b)},set:function(b,a){var c=this.data[b];a=this.model.restoreField(this,b,a);this.data[b]=a;c!=a&&(this.modified[b]=!0,this.setDirty(!0),this.trigger("change",this,b,a,c),this.trigger("change-"+b,this,b,a,c))},revert:function(){this.dirty&&
(this.data=p({},this.orig),this.modified={},this.setDirty(!1))},load:function(){var b=this;b.loading=!0;b.trigger("before-load",b);return b.model.loadRecord(b.id).always(function(){b.loading=!1}).done(function(a){b.setId(a.id);b.importData(a.data);b.trigger("load",b)}).fail(function(){b.trigger("failed-load",b)})},save:function(b,a){var c=this;c.trigger("before-save",c);var d=c.getId()?c.importUponSave:c.importUponCreate;return c.model.saveRecord(c,b,a).done(function(a){a.id&&c.setId(a.id);d&&c.importData(a.data);
c.trigger("save",c)}).fail(function(a){c.trigger("failed-save",c)})},"delete":function(){var b=this;b.trigger("before-delete",b);return b.model.deleteRecord(b).done(function(){b.trigger("delete",b);b.$destroy()}).fail(function(){b.trigger("failed-delete",b)})},reset:function(){this.id=null;this.data={};this.orig={};this.modified={};this.dirty=this.loaded=!1;this.trigger("reset",this)},destroy:function(){I.removeFromCache(this.$getClass(),this.id);this.$super()}}),Ba=function(){var b=function(a,c,
b){if(w(c))return c(a,b);if(""===c||void 0===c)return!0;if(void 0!==a){if(ja(a))return a===c;if(c instanceof RegExp)return c.test(""+a);if("strict"==b)return""+a===""+c;if(!0===b||null===b||void 0===b)return-1!=(""+a).toLowerCase().indexOf((""+c).toLowerCase());if(!1===b)return-1==(""+a).toLowerCase().indexOf((""+c).toLowerCase())}return!1},a=function(a,c,f){if(w(c))return c(a,f);var d=ba(a);if(3>d&&-1<d)return void 0===c.$?!0:b(a,c.$,f);var e,k;for(e in c)if("$"==e)for(k in a){if(b(a[k],c.$,f))return!0}else if(b(a[e],
c[e],f))return!0;return!1},c=function(c,b,f){V(b)||w(b)||(b={$:b});var d=[],e;var k=-1;for(e=c.length;++k<e;)a(c[k],b,f)&&d.push(c[k]);return d};c.compare=a;return c}();(function(){var b=Array.prototype.indexOf;b||(b=Array.prototype.indexOf=function(a,c){if(null==this)throw new TypeError('"this" is null or not defined');var b=Object(this),e=b.length>>>0;if(0===e)return-1;c=+c||0;Infinity===Math.abs(c)&&(c=0);if(c>=e)return-1;for(c=Math.max(0<=c?c:e-Math.abs(c),0);c<e;){if(c in b&&b[c]===a)return c;
c++}return-1});return b})();Y=function(){var b={};return M({$class:"Store",$mixins:["mixin.Observable"],id:null,autoLoad:!1,clearOnLoad:!0,model:null,extraParams:null,loaded:!1,loading:!1,local:!1,items:null,current:null,map:null,currentMap:null,length:0,currentLength:0,maxLength:0,totalLength:0,start:0,pageSize:null,pages:null,filtered:!1,sorted:!1,filterBy:null,filterOpt:null,sortBy:null,sortDir:null,publicStore:!1,idProp:null,loadingPromise:null,$init:function(a,c,d){this.items=[];this.current=
[];this.map={};this.currentMap={};this.loaded=!1;this.extraParams=this.extraParams||{};a&&!u(a)&&(d=c,c=a,a=null);c=c||{};a&&(c.url=a);this.$super(c);p(this,c,!0,!1);this.id=this.id||fa();this.publicStore&&(b[this.id]=this);this.initModel(c);this.$$observable.createEvent("beforeload",!1);!this.local&&this.autoLoad?this.load():d&&(J(d)?this._loadArray(d):this._loadAjaxData(d));this.local&&(this.loaded=!0);this.sourceStore&&this.initSourceStore(this.sourceStore,"on")},setModel:function(a){this.model=
a;this.initModel({})},initModel:function(a){u(this.model)?this.model=I.create(this.model):this.model instanceof I||(this.model=new I(this.model));a.url&&(this.model.store.load=a.url);this.idProp=this.model.getStoreProp("load","id")},initSourceStore:function(a,c){a[c]("update",this.onSourceStoreUpdate,this)},onSourceStoreUpdate:function(){this.$$observable.suspendAllEvents();this.clear();this.addMany(this.sourceStore.toArray());this.$$observable.resumeAllEvents();this.trigger("update",this)},getId:function(){return this.id},
isLoaded:function(){return this.loaded},isLocal:function(){return this.local},setLocal:function(a){this.local=!!a},isLoading:function(){return this.loading},isFiltered:function(){return this.filtered},isSorted:function(){return this.sorted},getLength:function(a){return a?this.length:this.currentLength},getTotalLength:function(){return this.totalLength||this.currentLength},isEmpty:function(){return 0===this.length},getPagesCount:function(){return null!==this.pageSize?parseInt(this.totalLength/this.pageSize):
1},setParam:function(a,c){null===c?delete this.extraParams[a]:this.extraParams[a]=c},getParam:function(a){return this.extraParams[a]},getParams:function(){return p({},this.extraParams)},clearParams:function(){this.extraParams={}},setStart:function(a){this.start=a},setPageSize:function(a){this.pageSize=a},getAjaxData:function(){return this.ajaxData},hasDirty:function(a){if(this.model.isPlain())return!1;var c=!1;this.each(function(a){return a.isDirty()?(c=!0,!1):!0},null,a);return c},getDirty:function(a){var c=
[];if(this.model.isPlain())return c;this.each(function(a){a.isDirty()&&c.push(a)},null,a);return c},getModel:function(){return this.model},toArray:function(){return this.current},_loadAjaxData:function(a,c){var b=this;c=c||{};if(c.silent||!1!==b.trigger("before-load",b))b.ajaxData=a,b.model._processStoreResponse("load",a,{resolve:function(a){b._onModelLoadSuccess(a,c)},reject:function(a){b._onModelLoadFail(a,c)}})},_loadArray:function(a,c){c=c||{};(c.silent||!1!==this.trigger("before-load",this))&&
J(a)&&(this._load(a,c),this.totalLength=this.length)},_load:function(a,c){var b=c.prepend;c=c||{};a=a||[];b?this.insertMany(0,a,!0,!0):this.addMany(a,!0,!0);this.loaded=!0;this.loading=!1;this.trigger("loading-end",this);this.onLoad();c.skipUpdate||this.update();c.silent||this.trigger("load",this)},load:function(a,c){var b=this,e=b.model.store,f=e.start;e=e.limit;var g=b.pageSize;b.loadingPromise&&b.loadingPromise.abort&&b.loadingPromise.abort();c=c||{};if(b.local)return null;a=p({},b.extraParams,
a||{});null===g||a[f]||a[e]||(f&&(a[f]=b.start),e&&(a[e]=g));if(!c.silent&&!1===b.trigger("before-load",b))return null;b.loading=!0;b.trigger("loading-start",b);return b.loadingPromise=b.model.loadStore(b,a).done(function(a){b.$destroyed||(b.loadingPromise=null,b.ajaxData=b.model.lastAjaxResponse,b._onModelLoadSuccess(a,c))}).fail(function(a){b.$destroyed||(b.loadingPromise=null,b.ajaxData=b.model.lastAjaxResponse,b._onModelLoadFail(a,c))})},_onModelLoadSuccess:function(a,c){c=c||{};if(!c.noopOnEmpty||
a.data.length)!c.prepend&&!c.append&&this.clearOnLoad&&0<this.length&&this.clear(!0),this.totalLength=parseInt(a.total),this._load(a.data,c)},_onModelLoadFail:function(a,c){this.onFailedLoad();c.silent||this.trigger("failed-load",this,a)},onLoad:t,onFailedLoad:t,save:function(a){var c=this,b={},e=0;if(c.local)return null;if(c.model.isPlain())throw Error("Cannot save plain store");c.each(function(a){a.isDirty()&&(b[a.getId()]=a.storeData(a.getData()),e++)});if(!e)throw Error("Nothing to save");return a||
!1!==c.trigger("before-save",c,b)?c.model.saveStore(c,b).done(function(b){c._onModelSaveSuccess(b,a)}).fail(function(b){c._onModelSaveFail(b,a)}):null},_onModelSaveSuccess:function(a,c){var b,e=a.data;if(e&&e.length)for(a=0,b=e.length;a<b;a++){var f=this.getRecordId(e[a]);(f=this.getById(f))&&f.importData(e[a])}this.onSave();c||this.trigger("save",this)},_onModelSaveFail:function(a,c){this.onFailedSave(a);c||this.trigger("failed-save",this)},onSave:t,onFailedSave:t,deleteById:function(a,c,b){var d=
this,f;if(d.local)return null;if(!a||J(a)&&!a.length)throw Error("Record id required");J(a)||(a=[a]);var g=0;for(f=a.length;g<f;g++){var h=d.getById(a[g]);d.remove(h,c,b);h instanceof U&&h.$destroy()}return c||!1!==d.trigger("before-delete",d,a)?d.model.deleteRecords(d,a).done(function(){d.totalLength-=a.length;d.onDelete();c||d.trigger("delete",d,a)}).fail(function(){d.onFailedDelete();c||d.trigger("failed-delete",d,a)}):null},onDelete:t,onFailedDelete:t,deleteAt:function(a,c,b){var d=this.getAt(a);
if(!d)throw Error("Record not found at "+a);return this["delete"](d,c,b)},"delete":function(a,c,b){return this.deleteById(this.getRecordId(a),c,b)},deleteRecords:function(a,c,b){var d=[],f;var g=0;for(f=a.length;g<f;g++)d.push(this.getRecordId(a[g]));return this.deleteById(d,c,b)},loadOr:function(a,c,b){this.local||this.isLoading()||(this.isLoaded()?a&&a.call(c||this):this.load(null,b))},addPrevPage:function(a){a=a||{};a.append=!1;a.prepend=!0;a.noopOnEmpty=!0;return this.loadPrevPage(a)},addNextPage:function(a){a=
a||{};a.append=!0;a.prepend=!1;a.noopOnEmpty=!0;if(!this.local&&(!this.totalLength||this.length<this.totalLength))return this.load({start:this.length,limit:this.pageSize},a)},loadNextPage:function(a){if(!this.local&&(!this.totalLength||this.length<this.totalLength))return this.start+=this.pageSize,this.load(null,a)},loadPrevPage:function(a){if(!this.local&&0<this.start)return this.start-=this.pageSize,0>this.start&&(this.start=0),this.load(null,a)},loadPage:function(a,c){if(!this.local)return this.start=
parseInt(a,10),0>this.start&&(this.start=0),this.load(null,c)},getRecordId:function(a){return a instanceof U?a.getId():this.model?this.model.getRecordId(a)||a[this.idProp]||null:a[this.idProp]||null},getRecordData:function(a){return this.model.isPlain()?a:a.data},processRawDataItem:function(a){if(a instanceof U)return a;if(this.model.isPlain())return this.model.extendPlainRecord(a);var c=this.model.type,b=this.getRecordId(a),e;b&&(e=I.getFromCache(c,b));e||(e=ia(c,b,a,{model:this.model,standalone:!1}));
return e},bindRecord:function(a,c){c[a]("change",this.onRecordChange,this);c[a]("destroy",this.onRecordDestroy,this);c[a]("dirty-change",this.onRecordDirtyChange,this);return c},onRecordDirtyChange:function(a){this.trigger("update",this,a)},onRecordChange:function(a,c,b,e){this.trigger("update",this,a)},onRecordDestroy:function(a){this.remove(a)},shift:function(a,c,b){return this.removeAt(0,1,a,c,b)},unshift:function(a,c,b){return this.insert(0,a,c,b)},pop:function(a,c,b){return this.removeAt(this.length-
1,1,a,c,b)},addMany:function(a,c,b){var d,f=this.length;var g=0;for(d=a.length;g<d;g++)this.insert(f+g,a[g],!0,!0);b||this.update();0<d&&!c&&this.trigger("add",a)},add:function(a,c,b){return this.insert(this.length,a,c,b)},onAdd:t,removeAt:function(a,c,b,e,f){var d=0,h=this.length;if(0!==h&&null!=a){for(;0>a;)a=h+a;null==c&&(c=1);for(f||(a=this.items.indexOf(this.current[a]));a<this.length&&0<=a&&d<c;){this.length--;f=this.items[a];this.items.splice(a,1);h=this.getRecordId(f);void 0!==h&&(delete this.map[h],
delete this.currentMap[h]);this.onRemove(f,h);e||this.update();b||this.trigger("remove",f,h);if(f instanceof U){if(this.bindRecord("un",f),f.detachStore(this),1===c)return f.$destroyed?void 0:f}else if(1===c)return f;d++}}},removeRange:function(a,c,b,e,f){var d=this.length;if(0!==d){if(null==a&&null==c)return this.clear(b);for(null==a&&(a=0);0>a;)a=d+a;for(null==c&&(c=d-1);0>c;)c=d+a;return this.removeAt(a,c-a+1,b,e,f)}},onRemove:t,insertMany:function(a,c,b,e){var d;var g=0;for(d=c.length;g<d;g++)this.insert(a+
g,c[g],!0,!0);0<d&&!e&&this.update();0<d&&!b&&this.trigger("add",c)},insert:function(a,c,b,e){var d=!1;c=this.processRawDataItem(c);var g=this.getRecordId(c);this.map[g]&&(this.$$observable.suspendAllEvents(),this.removeId(g),this.$$observable.resumeAllEvents());a>=this.length?(this.items.push(c),d=!0):this.items.splice(a,0,c);this.length++;this.maxLength&&this.length>this.maxLength&&(d?this.pop(b,!0):this.shift(b,!0));void 0!==g&&(this.map[g]=c);c instanceof U&&(c.attachStore(this),this.bindRecord("on",
c));this.onAdd(a,c);e||this.update();b||this.trigger("add",[c]);return c},replace:function(a,c,b,e){var d=this.items.indexOf(a);this.removeAt(d,1,!0,!0,!0);this.insert(d,c,!0,!0);e||this.update();b||this.trigger("replace",a,c);return c},replaceId:function(a,c,b,e){a=this.indexOfId(a);return this.replace(this.getAt(a),c)},onReplace:t,remove:function(a,c,b){a=this.indexOf(a,!0);return-1!==a?this.removeAt(a,1,c,b,!0):null},removeId:function(a,c,b){a=this.indexOfId(a,!0);if(-1!==a)return this.removeAt(a,
1,c,b,!0)},contains:function(a,c){return-1!==this.indexOf(a,c)},containsId:function(a,c){return c?void 0!==this.map[a]:void 0!==this.currentMap[a]},clear:function(a){var c=this.getRange();this._reset();this.onClear();a||this.trigger("clear",c)},onClear:t,reset:function(){this._reset();this.start=0},_reset:function(a){var c;if(!a)for(a=0,c=this.items.length;a<c;a++){var b=this.items[a];b instanceof U&&(this.bindRecord("un",b),b.detachStore(this))}this.totalLength=this.currentLength=this.length=0;this.items=
[];this.current=[];this.map={};this.currentMap={};this.loaded=this.local},getAt:function(a,b){return b?this.items[a]||void 0:this.current[a]||void 0},getById:function(a,b){return b?this.map[a]||void 0:this.currentMap[a]||void 0},indexOf:function(a,b){return b?this.items.indexOf(a):this.current.indexOf(a)},indexOfId:function(a,b){return this.indexOf(this.getById(a,b),b)},each:function(a,b,d){d=d?this.items.slice():this.current.slice();for(var c=0,f=d.length;c<f&&!1!==a.call(b,d[c],c,f);c++);},eachId:function(a,
b,d){var c=this;c.each(function(d,e,h){return a.call(b,c.getRecordId(d),e,h)},null,d)},collect:function(a,b){var c=[],e=!this.model.isPlain();this.each(function(b){(b=e?b.get(a):b[a])&&c.push(b)},null,b);return c},first:function(a){return a?this.items[0]:this.current[0]},last:function(a){return a?this.items[this.length-1]:this.current[this.current-1]},getRange:function(a,b,d){d=d?this.items:this.current;var c=[];if(1>d.length)return c;a=a||0;b=Math.min(void 0==b?this.length-1:b,this.length-1);if(a<=
b)for(;a<=b;a++)c.push(d[a]);else for(;a>=b;a--)c.push(d[a]);return c},findBy:function(a,b,d,e){a=this.findIndexBy(a,b,d,e);return-1===a?void 0:this.getAt(a,e)},findIndexBy:function(a,b,d,e){e=e?this.items:this.current;d=d||0;for(var c=e.length;d<c;d++)if(a.call(b,e[d],this.getRecordId(e[d])))return d;return-1},find:function(a,b,d,e){var c=!this.model.isPlain(),g,h=this.findIndexBy(function(e){g=c?e.get(a):e[a];return d?g===b:g==b},this,0,e);return-1!==h?this.getAt(h,e):null},findExact:function(a,
b,d){return this.find(a,b,!0,d)},findBySet:function(a,b){var c=null,e,f;this.each(function(b){e=!0;for(f in a)if(a[f]!=b[f]){e=!1;break}return e?(c=b,!1):!0},null,b);return c},update:function(){var a=this,b=a.filtered,d=a.sorted,e=a.model.isPlain();a.currentLength=a.length;a.currentMap=a.map;a.current=a.items;if(b){var f=a.filterBy,g=a.filterOpt,h,k;a.current=h=[];a.currentMap=k={};a.each(function(b){Ba.compare(e?b:b.data,f,g)&&(h.push(b),k[a.getRecordId(b)]=b)},null,!0);a.currentLength=a.current.length}if(d){var l=
a.sortBy,n=!a.model.isPlain();a.current=wa(a.current,function(a){return n?a.get(l):a[l]},a.sortDir)}a.trigger("update",a)},filter:function(a,b){this.filtered=!0;this.filterBy=a;this.filterOpt=b;this.update()},clearFilter:function(){this.filtered&&(this.filterOpt=this.filterBy=null,this.update())},sort:function(a,b){this.sorted=!0;this.sortBy=a;this.sortDir=b;this.update()},clearSorting:function(){this.sorted=!1;this.sortDir=this.sortBy=null;this.update()},destroy:function(){delete b[this.id];this.sourceStore&&
this.initSourceStore(this.sourceStore,"un");this.clear();this.trigger("destroy",this);this.$super()}},{lookupStore:function(a){return b[a]||null},eachStore:function(a,c){for(var d in b)if(!1===a.call(c,b[d]))break}})}();H={};H.Model=I;H.Record=U;H.Store=Y;"undefined"!=typeof global?global.MetaphorJs=H:window.MetaphorJs=H})();
